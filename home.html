<!DOCTYPE html>
<html>
	<head>
	<!--Import materialize.css-->
		<link type="text/css" rel="stylesheet" href="css/materialize.css"  media="screen,projection"/>

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	</head>

	<body>
		<nav class="light-blue lighten-1" role="navigation">
			<div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Dashboard</a>
				<!--ul class="right hide-on-med-and-down">
					<li><a href="#">Navbar Link</a></li>
				</ul-->
			
				<ul id="nav-mobile" class="side-nav">
					<li>
						<span class="blue-text text-darken-2">
							<h4>Info Aplikasi !</h4>
						</span>
						<span class="black-text text-darken-2">
							<p >Versi SIEMAK Android 0.1b</p>
							<small style="text-align:justify;">
							<p class="flow-text">
								Aplikasi SIEMAK Android 0.1b ini digunakan untuk memudahkan mahasiswa untuk melakukan penilaian terhadap
								kinerja dosen saat melakukan kegiatan akademik yang bertempat di kelas.
							
								Aplikasi ini juga terintegrasi dengan data Siakad Trunojoyo sehingga memudahkan mahasiswa dengan sistem single sign in.
								Untuk mahasiswa, 
								silahkan login menggunakan <b>NRP</b> sebagai username dan <b>password siakad</b> sebagai password
							</p>
							<p>
								Info developer : <a href="http://siemak.web.id" target="_blank">KLIK</a> 
							</p>
							</small>
							<a href="status_koneksi.html">Status Koneksi</a>
						</span>
					</li>
				</ul>
				<a href="#" data-activates="nav-mobile" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
			</div>
		</nav>
		
		<div class="container" id="me">
			<div class="row">
				<h4 class="header center orange-text">Selamat Datang</h4>
				<!--Profil-->
				<div class="col s12">
					<table class="bordered">
						<tr>
							<td>Nama</td>
							<td id="nama">
								<!--preloader-->
								<div class="progress wait">
									<div class="indeterminate"></div>
								</div>
								<!--preloader-->
							</td>
						</tr>
						<tr>
							<td>Status</td>
							<td id="status">
								<!--preloader-->
								<div class="progress wait">
									<div class="indeterminate"></div>
								</div>
								<!--preloader-->
							</td>
						</tr>
						<tr>
							<td>Semester</td>
							<td id="semester">
								<!--preloader-->
								<div class="progress wait">
									<div class="indeterminate"></div>
								</div>
								<!--preloader-->
							</td>
						</tr>
						<tr>
							<td>Log</td>
							<td id="lastlog" class="center-align">
								<!--preloader-->
								<div class="progress wait">
									<div class="indeterminate"></div>
								</div>
								<!--preloader-->
							</td>
						</tr>
					</table>
				</div>
				<!--Profil-->
				<div class="grid-example col s12 m6">
					<span id="content">	
					</span>
				</div>
				<hr/>
				
				<span id="total_mk" colspan="2">
					<!--preloader-->
					<div class="progress wait">
						<div class="indeterminate"></div>
					</div>
					<!--preloader-->
				</span>
				
				<table class="responsive-table">
					<thead>
					<tr>
						<th data-field="id">Kode</th>
						<th data-field="name">Mata Kuliah</th>
						<th data-field="price">Status Form</th>
					</tr>
					</thead>

					<tbody id='isi_mk'>
						<!--preloader-->
						<tr class="wait">
							<td colspan="3">
								<div class="progress ">
									<div class="indeterminate"></div>
								</div>
							</td>
						</tr>
						<!--preloader-->
					</tbody>
				</table>
			</div>
		</div>

		<footer class="page-footer light-blue lighten-1">
			<div class="footer-copyright light-blue lighten-1">
				<div class="container center-align">
					&copy; 2015 JAMU Teknik Informatika Trunojoyo Madura
				</div>
			</div>
		</footer>


		<!--  Scripts-->
		<script src="js/jquery-2.1.1.min.js"></script>
		<script src="js/materialize.js"></script>
		<script src="js/init.js"></script>
		<script>
			$("#me").css("display", "none");
			//fungsi untuk get url parameter buat data di ajax
			 function getUrlParameter(sParam)
			{
				var sPageURL = window.location.search.substring(1);
				var sURLVariables = sPageURL.split('&');
				for (var i = 0; i < sURLVariables.length; i++) 
				{
					var sParameterName = sURLVariables[i].split('=');
					if (sParameterName[0] == sParam) 
					{
						return sParameterName[1];
					}
				}
			}         
		   
		   $.ajaxSetup ({
				// Disable caching of AJAX responses
				cache: false
			});
			
			var usernamex = getUrlParameter('username');
			var password = getUrlParameter('pass') ;
			
			$(document).ready(function(){
				$.ajax({
					type       : "GET",
					//url        : "http://arisis.my.id/jsonp/index.php",
					url        : "http://siemak.web.id/api_m/login_api",
					//url        : "http://siemak.ta/api_m/login_api",
					data       : {username : usernamex , password : password},
					jsonpCallback   : "A97ac68d16d468ef7d1800251926cca0e",
					dataType   : 'jsonp',
					success    : function(response) {
						if(response.valid == 'Ya'){
							$(".wait").css("display", "none");
							$("#me").css("display", "block");
							$('#nama').html(response.nama);
							$('#status').html(response.status);
							$('#semester').html(response.semester);
							$('#lastlog').html(response.lastlog);
							$('#total_mk').append('Total Mata Kuliah: '+response.total_mk);
							
							//looping that
							$.each(response.mk, function(i, item) {
								//alert("kode_mk="+item.kode_mk+"\n");
								if(item.form_status == 1){
									statuse_mk = 'sudah terisi';
								}
								else if(item.kode_mk == 'TIF136'){
									statuse_mk = 'Form Tidak Tersedia';
								}
								else{
									statuse_mk = '<a href="kuis.html?nrp='+item.id_mhw+'">Isi</a>';
								}
								
								mk_to_id ='<tr><td>'+item.kode_mk+'</td><td>'+item.mk_mhw+'</td><td>'+statuse_mk+'</td></tr>';
								$('#isi_mk').append(mk_to_id);
							});
							
						}
						else{
							alert('Mohon Periksa Kemabali Username / Password Anda!');
							window.location.replace("index.html"); 
						//	hasile = '<p>'+ response.pesan +'<p>';
						//	$('#content').html(hasile);
						}
					},
					error      : function() {
						//console.error("error");
						alert('Not working!');
						window.location.replace("index.html");                        
					}
				});
				
			});
		</script>
	</body>
</html>
